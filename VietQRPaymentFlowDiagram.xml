<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" version="29.2.7">
  <diagram id="vietqr-payment-flow" name="VietQR Payment Flow Diagram">
    <mxGraphModel dx="1426" dy="743" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="2200" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=30;fontStyle=1" value="VietQR Payment Flow Diagram" vertex="1">
          <mxGeometry height="50" width="600" x="500" y="30" as="geometry" />
        </mxCell>
        <mxCell id="start" parent="1" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=22" value="Start" vertex="1">
          <mxGeometry height="70" width="140" x="730" y="100" as="geometry" />
        </mxCell>
        <mxCell id="step1" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=20" value="Order created with&#xa;Status = PENDING&#xa;PaymentStatus = UNPAID" vertex="1">
          <mxGeometry height="90" width="300" x="650" y="210" as="geometry" />
        </mxCell>
        <mxCell id="arrow1" edge="1" parent="1" source="start" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="step1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="step2" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=20" value="User selects VietQR&#xa;payment method" vertex="1">
          <mxGeometry height="70" width="300" x="650" y="340" as="geometry" />
        </mxCell>
        <mxCell id="arrow2" edge="1" parent="1" source="step1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="step2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="step3" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=20" value="POST /api/payments/vietqr/{orderId}&#xa;Create VietQR Payment Record&#xa;PaymentStatus = PENDING" vertex="1">
          <mxGeometry height="90" width="360" x="620" y="450" as="geometry" />
        </mxCell>
        <mxCell id="arrow3" edge="1" parent="1" source="step2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="step3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="step4" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=20" value="Generate VietQR Code&#xa;(Bank Account + Amount + Transaction ID)&#xa;Return qrCodeUrl to Frontend" vertex="1">
          <mxGeometry height="90" width="400" x="600" y="580" as="geometry" />
        </mxCell>
        <mxCell id="arrow4" edge="1" parent="1" source="step3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="step4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="step5" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=20" value="Display VietQR Modal&#xa;Show QR Code + Bank Info&#xa;User scans QR with Banking App" vertex="1">
          <mxGeometry height="90" width="360" x="620" y="710" as="geometry" />
        </mxCell>
        <mxCell id="arrow5" edge="1" parent="1" source="step4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="step5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="step6" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=20" value="User completes bank transfer&#xa;via Banking App" vertex="1">
          <mxGeometry height="70" width="300" x="650" y="840" as="geometry" />
        </mxCell>
        <mxCell id="arrow6" edge="1" parent="1" source="step5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="step6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="step7" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=20" value="POST /api/payments/vietqr/{paymentId}/proof&#xa;User uploads transfer proof image&#xa;(Screenshot of successful transfer)" vertex="1">
          <mxGeometry height="90" width="400" x="600" y="950" as="geometry" />
        </mxCell>
        <mxCell id="arrow7" edge="1" parent="1" source="step6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="step7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="step8" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=20" value="Payment Status = PENDING&#xa;Waiting for Admin verification&#xa;proofImageUrl saved" vertex="1">
          <mxGeometry height="90" width="360" x="620" y="1080" as="geometry" />
        </mxCell>
        <mxCell id="arrow8" edge="1" parent="1" source="step7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="step8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="decision1" parent="1" style="rhombus;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=20;fontColor=#333333" value="Admin&#xa;Review" vertex="1">
          <mxGeometry height="120" width="200" x="700" y="1210" as="geometry" />
        </mxCell>
        <mxCell id="arrow9" edge="1" parent="1" source="step8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="decision1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="confirmStep" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=20" value="PUT /api/payments/vietqr/{paymentId}/confirm&#xa;Admin confirms payment" vertex="1">
          <mxGeometry height="80" width="400" x="200" y="1370" as="geometry" />
        </mxCell>
        <mxCell id="arrowConfirm" edge="1" parent="1" source="decision1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontSize=18" target="confirmStep" value="Confirm">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="successStep" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=20" value="Payment Status = SUCCESS&#xa;Order Status = CONFIRMED&#xa;Order PaymentStatus = PAID" vertex="1">
          <mxGeometry height="90" width="400" x="200" y="1490" as="geometry" />
        </mxCell>
        <mxCell id="arrowSuccess" edge="1" parent="1" source="confirmStep" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="successStep">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rejectStep" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=20" value="PUT /api/payments/vietqr/{paymentId}/reject&#xa;Admin rejects payment&#xa;(with optional reason)" vertex="1">
          <mxGeometry height="90" width="400" x="1000" y="1370" as="geometry" />
        </mxCell>
        <mxCell id="arrowReject" edge="1" parent="1" source="decision1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontSize=18" target="rejectStep" value="Reject">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="failedStep" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=20" value="Payment Status = FAILED&#xa;Order PaymentStatus = UNPAID&#xa;User notified of rejection" vertex="1">
          <mxGeometry height="90" width="400" x="1000" y="1500" as="geometry" />
        </mxCell>
        <mxCell id="arrowFailed" edge="1" parent="1" source="rejectStep" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="failedStep">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="decision2" parent="1" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=20" value="User&#xa;Retry?" vertex="1">
          <mxGeometry height="120" width="200" x="1100" y="1630" as="geometry" />
        </mxCell>
        <mxCell id="arrowToRetry" edge="1" parent="1" source="failedStep" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="decision2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrowRetryYes" edge="1" parent="1" source="decision2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontSize=18;exitX=1;exitY=0.5;exitDx=0;exitDy=0" target="step5" value="Yes">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1450" y="1690" />
              <mxPoint x="1450" y="755" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="notifyStep" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=20" value="Send notification to user&#xa;(Payment confirmed / Order updated)" vertex="1">
          <mxGeometry height="80" width="400" x="200" y="1620" as="geometry" />
        </mxCell>
        <mxCell id="arrowNotify" edge="1" parent="1" source="successStep" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="notifyStep">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="endSuccess" parent="1" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=22" value="End&#xa;(Success)" vertex="1">
          <mxGeometry height="80" width="140" x="330" y="1740" as="geometry" />
        </mxCell>
        <mxCell id="arrowEndSuccess" edge="1" parent="1" source="notifyStep" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="endSuccess">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="endFailed" parent="1" style="ellipse;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontStyle=1;fontSize=22" value="End&#xa;(Canceled)" vertex="1">
          <mxGeometry height="80" width="140" x="1130" y="1800" as="geometry" />
        </mxCell>
        <mxCell id="arrowEndFailed" edge="1" parent="1" source="decision2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontSize=18" target="endFailed" value="No">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
